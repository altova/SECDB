EDGAR SEC DB Schema
===================

This document gives a brief description about all tables and fields in the database generated by the `build_secdb.py` script.

DB Tables
---------

The metadata for each EDGAR filing is stored as a separate row in the `filings` tables. The actual data is also stored as a separate row in the `balance_sheet`, `income_statement`, `cashflow_statement` and `ratios` tables. The `accessionNumber` is used as a primary key for each EDGAR filing and links all of these tables together. The `ticker` table enables client applications to provide search functionality by a stock ticker symbol. The `facts` table contains the actual XBRL fact values as reported in the filing.

### TABLE tickers
The `tickers` table provides a way to find the company's CIK number from a ticker symbol. Each row maps exactly one ticker symbol to a CIK number.

|name | type | description |
|:---|:---:|:---|
| symbol | VARCHAR(10) | A company's ticker symbol |
| cikNumber | INTEGER	| A company's CIK number |

### TABLE filings
The `filings` table contains meta-information about each filing. Each row contains the meta-information for exactly one filing (quarterly or annual report). The primary key is the `accessionNumber` which should be unique for each filing.

|name | type | description |
|:---|:---:|:---|
|	accessionNumber						| CHAR(20)		| SEC accession number (unique for each filing)
|	cikNumber							| INTEGER			| CIK number (Central Index Key)
|	companyName							| TEXT			| Company name
|	formType							| TEXT			| Type of filing (10-K or 10-Q)
|	filingDate							| DATETIME		| Filing date
|	fileNumber							| TEXT			| SEC file number
|	acceptanceDatetime					| DATETIME		| SEC acceptance date
|	period								| DATE			| The end date of the reporting period
|	assistantDirector					| TEXT			| Identifies office for assigned SEC assistant director
|	assignedSic							| INTEGER			| SIC number (Standard Industry Classification)
|	otherCikNumbers						| TEXT			| Additional CIK numbers for the company
|	fiscalYearEnd						| INTEGER			| The end date of the company’s fiscal year
|	instanceUrl							| TEXT			| Relative uri to the XBRL instance file within the zip archive
|	errors								| TEXT			| Error log in text format if filing was not XBRL valid

### TABLE facts

|name | type | description |
|:---|:---:|:---|
| 	accessionNumber						| VARCHAR(255)	| Identifies the XBRL instance
| 	report								| TEXT			| Identifies the statement (balance, income or chashflow)
| 	pos									| SMALLINT		| Position of fact in presentation view (starting from 0)
| 	lineitem							| TEXT			| Name of lineitem (using db column names)
| 	label								| TEXT			| Label as appeared in presentation view (taking preferred label role into account)
| 	namespace							| TEXT			| Concept namespace
| 	name								| TEXT			| Concept local name
| 	value								| TEXT			| Fact value (could be either a monetary, real, string or NIL)
| 	level								| SMALLINT		| Indentation level (starting from 0)
| 	is_abstract							| BOOLEAN		| 	Abstract flag (abstract concepts cannot occur within the instance and are usually used as headings)
| 	is_total							| BOOLEAN		| 	Total flag (usually indicates that this line item represents the total of the previous line items on the same level)
| 	is_negated							| BOOLEAN		| 	Negated flag (usually indicates that the value should be shown on the report with the opposite sign)

### TABLE balance_sheet
Each row contains the balance sheet data for the filing identified by accessionNumber.

|name | type | description |
|:---|:---:|:---|
|	accessionNumber						| CHAR(20)		| SEC accession number (unique for each filing)
|	cikNumber							| INTEGER		| 	CIK number (Central Index Key)
|	endDate								| DATE			| The instant in time for which the balance sheet was prepared
|	currencyCode						| CHAR(3)		| 	ISO4217 currency code (currently only USD)
|	cashAndCashEquivalents				| BIGINT		| 	Cash And Cash Equivalents
|	shortTermInvestments				| BIGINT		| 	Short Term Investments
|	cashAndShortTermInvestments			| BIGINT		| 	Cash and Short Term Investments
|	receivablesNet						| BIGINT		| 	Net Receivables
|	inventory							| BIGINT		| 	Inventory
|	currentAssetsOther					| BIGINT		| 	Other Current Assets
|	currentAssetsTotal					| BIGINT		| 	Total Current Assets
|	longTermInvestments					| BIGINT		| 	Long Term Investments
|	propertyPlantAndEquipmentGross		| BIGINT		| 	Property Plant and Equipment, Gross
|	accumulatedDepreciation				| BIGINT		| 	Accumulated Depreciation
|	propertyPlantAndEquipmentNet		| BIGINT		| 	Property Plant and Equipment, Net
|	goodwill							| BIGINT		| 	Goodwill
|	intangibleAssets					| BIGINT		| 	Intangible Assets
|	accumulatedAmortization				| BIGINT		| 	Accumulated Amortization
|	nonCurrrentAssetsOther				| BIGINT		| 	Other Assets
|	deferredLongTermAssetCharges		| BIGINT		| 	Deferred Long Term Asset Charges
|	nonCurrentAssetsTotal				| BIGINT		| 	Total Non-current Assets
|	assetsTotal							| BIGINT		| 	Total Assets
|	accountsPayable						| BIGINT		| 	Accounts Payable
|	shortTermDebt						| BIGINT		| 	Short/Current Long Term Debt
|	currentLiabilitiesOther				| BIGINT		| 	Other Current Liabilities
|	currentLiabilitiesTotal				| BIGINT		| 	Total Current Liabilities
|	longTermDebt						| BIGINT		| 	Long Term Debt
|	capitalLeaseObligations				| BIGINT		| 	Capital Lease Obligations
|	longTermDebtTotal					| BIGINT		| 	Long Term Debt, Total
|	nonCurrentLiabilitiesOther			| BIGINT		| 	Other Liabilities
|	deferredLongTermLiabilityCharges	| BIGINT		| 	Deferred Long Term Liability Charges
|	minorityInterest					| BIGINT		| 	Minority Interest
|	negativeGoodwill					| BIGINT		| 	Negative Goodwill
|	nonCurrentLiabilitiesTotal			| BIGINT		| 	Total Non-current Liabilities
|	liabilitiesTotal					| BIGINT		| 	Total Liabilities
|	warrants							| BIGINT		| 	Misc Stocks Options Warrants
|	preferredStockRedeemable			| BIGINT		| 	Redeemable Preferred Stock
|	preferredStock						| BIGINT		| 	Preferred Stock
|	commonStock							| BIGINT		| 	Common Stock
|	retainedEarnings					| BIGINT		| 	Retained Earnings
|	treasuryStockValue					| BIGINT		| 	Treasury Stock
|	capitalSurpluse						| BIGINT		| 	Capital Surplus
|	stockholderEquityOther				| BIGINT		| 	Other Stockholder Equity
|	stockholderEquityTotal				| BIGINT		| 	Total Stockholder Equity
|	liabilitiesAndStockholdersEquity	| BIGINT		| 	Total Liabilities and Stockholder Equity
|	tangibleAssetsNet					| BIGINT		| 	Net Tangible Assets

### TABLE income_statement
Each row contains the income statement data for the filing identified by accessionNumber. Please note that for annual filings there are 2 rows with the same accessionNumber differing in the duration field (3 or 12 months).

|name | type | description |
|:---|:---:|:---|
|	accessionNumber						| CHAR(20)		| SEC accession number (unique for each filing)
|	cikNumber							| INTEGER			| CIK number (Central Index Key)
|	endDate								| DATE			| The instant in time for which the balance sheet was prepared
|	duration							| INTEGER			| Duration of the reporting period in months (N months ended)
|	currencyCode						| CHAR(3)			| ISO4217 currency code (currently only USD)
|	revenueTotal                        | BIGINT			| Total Revenue
|	costOfRevenue                       | BIGINT			| Cost of Revenue
|	profitGross                         | BIGINT			| Gross Profit
|	researchAndDevelopment              | BIGINT			| Research Development
|	sellingGeneralAndAdministrative     | BIGINT			| Selling General and Administrative
|	nonRecurring                        | BIGINT			| Non Recurring
|	operatingExpensesOther              | BIGINT			| Others
|	operatingExpensesTotal              | BIGINT			| Total Operating Expenses
|	operatingIncome                     | BIGINT			| Operating Income or Loss
|	nonOperatingIncomeNetOther          | BIGINT			| Total Other Income/Expenses Net
|	incomeBeforeInterestAndTax          | BIGINT			| Earnings Before Interest And Taxes
|	interestExpense                     | BIGINT			| Interest Expense
|	incomeBeforeTax                     | BIGINT			| Income Before Tax
|	incomeTaxExpense                    | BIGINT			| Income Tax Expense
|	minorityInterest                    | BIGINT			| Minority Interest
|	incomeNetFromContinuingOps          | BIGINT			| Net Income From Continuing Ops
|	discontinuedOps                     | BIGINT			| Discontinued Operations
|	extraordinaryItems                  | BIGINT			| Extraordinary Items
|	incomeNet                           | BIGINT			| Net Income
|	preferredStockAndOtherAdjustments   | BIGINT			| Preferred Stock And Other Adjustments
|	incomeNetApplicableToCommonShares   | BIGINT			| Net Income Applicable To Common Shares

### TABLE cashflow_statement
Each row contains the cashflow statement data for the filing identified by accessionNumber. Please note that for filings containing compounded data there are 2 rows with the same accessionNumber differing in the duration field (3 and one of 6, 9 or 12 months).

|name | type | description |
|:---|:---:|:---|
|	accessionNumber						| CHAR(20)		| SEC accession number (unique for each filing)
|	cikNumber							| INTEGER			| CIK number (Central Index Key)
|	endDate								| DATE			| The instant in time for which the balance sheet was prepared
|	duration							| INTEGER			| Duration of the reporting period in months (N months ended)
|	currencyCode						| CHAR(3)			| ISO4217 currency code (currently only USD)
|	netIncome                           | BIGINT			| Net Income
|	depreciation                        | BIGINT			| Depreciation
|	netIncomeAdjustments                | BIGINT			| Adjustments To Net Income
|	changeReceivables                   | BIGINT			| Changes In Accounts Receivables
|	changeLiabilities                   | BIGINT			| Changes In Liabilities
|	changeInventories                   | BIGINT			| Changes In Inventories
|	cashFlowsOtherOperating             | BIGINT			| Changes In Other Operating Activities
|	cashFlowsTotalOperating             | BIGINT			| Total Cash Flow From Operating Activities
|	capitalExpenditures                 | BIGINT			| Capital Expenditures
|	investments                         | BIGINT			| Investments
|	cashFlowsOtherInvesting             | BIGINT			| Other Cash flows from Investing Activities
|	cashFlowsTotalInvesting             | BIGINT			| Total Cash Flows From Investing Activities
|	dividends                           | BIGINT			| Dividends Paid
|	stockSalePurchase                   | BIGINT			| Sale Purchase of Stock
|	netBorrowings                       | BIGINT			| Net Borrowings
|	cashFlowsOtherFinancing             | BIGINT			| Other Cash Flows from Financing Activities
|	cashFlowsTotalFinancing             | BIGINT			| Total Cash Flows From Financing Activities
|	exchangeRateChanges                 | BIGINT			| Effect Of Exchange Rate Changes
|	cashAndCashEquivalentsChanges       | BIGINT			| Change In Cash and Cash Equivalents


### TABLE ratios
Each row contains the ratios calculated for the filing identified by accessionNumber. Currently, there are 2 sets of ratios: trailing twelve months (`ttm`) and annualized most recent quarter (`mrq`). The kind field must be used to differentiate between `ttm` and `mrq` ratios.

|name | type | description |
|:---|:---:|:---|
|	accessionNumber						| CHAR(20)		| SEC accession number (unique for each filing)
|	cikNumber							| INTEGER		| CIK number (Central Index Key)
|	endDate								| DATE			| The end date of the duration (e.g. 3 months ended 2014-12-31)
|	kind								| CHAR(3)		| The type of ratio (`ttm` or `mrq`)
|	currentRatio                        | REAL			| Current Ratio
|	quickRatio                          | REAL			| Quick Ratio
|	cashRatio                           | REAL			| Cash Ratio
|	grossProfitMargin                   | REAL			| Gross Profit Margin
|	operatingProfitMargin               | REAL			| Operating Profit Margin
|	pretaxProfitMargin                  | REAL			| Pretax Profit Margin
|	profitMargin                        | REAL			| Profit Margin
|	effectiveTaxRate                    | REAL			| Effective Tax Rate
|	returnOnSales                       | REAL			| Return on Sales
|	returnOnAssets                      | REAL			| Return on Assets
|	returnOnEquity                      | REAL			| Return on Equity
|	returnOnCaptialEmployed             | REAL			| Return on Capital Employed
|	debtRatio                           | REAL			| Debt Ratio
|	debtEquityRatio                     | REAL			| Debt-Equity Ratio
|	capitalizationRatio                 | REAL			| Capitalization Ratio
|	cashflowDebtRatio                   | REAL			| Cash Flow-Debt Ratio
|	interestCoverage                    | REAL			| Interest Coverage
|	assetTurnover                       | REAL			| Asset Turnover
|	fixedAssertTurnover                 | REAL			| Fixed Asset Turnover
|	receivablesTurnover                 | REAL			| Receivables Turnover
|	inventoryTurnover                   | REAL			| Inventory Turnover
|	operatingCashflowSales              | REAL			| OCF/Sales
|	freeOperatingCashflow               | REAL			| Free Cash Flow/OCF
|	shortTermDebtCoverage               | REAL			| Short-term Debt Coverage
|	capitalExpenditureCoverage          | REAL			| Capital Expenditure Coverage
|	dividendCoverage                    | REAL			| Dividend Coverage

SQL query examples
------------------

Find all filings for a ticker symbol:

```sql
SELECT *
FROM   "filings"
WHERE  "cikNumber" = (SELECT cikNumber FROM "tickers" WHERE "symbol" = "CCL")
```

Find all annual filings for a ticker symbol:

```sql
SELECT *
FROM   "filings"
WHERE  "cikNumber" = (SELECT cikNumber FROM "tickers" WHERE "symbol" = "CCL")
AND    "formType" = "10-K"
```

Find all filings with a given company name:

```sql
SELECT *
FROM   "filings"
WHERE  "companyName" LIKE "%CARNIVAL%"
```

Get all annual income statements for a ticker symbol:

```sql
SELECT * FROM "income_statement"
WHERE "duration" = 12
AND   "accessionNumber" IN (
	SELECT "accessionNumber"
	FROM   "filings"
	WHERE  "cikNumber" = (SELECT cikNumber FROM "tickers" WHERE symbol = "CCL")
	AND    "formType" = "10-K"
)
```

Get all quarterly income statements for a ticker symbol:

```sql
SELECT * FROM "income_statement"
WHERE "duration" = 3
AND   "accessionNumber" IN (
	SELECT "accessionNumber"
	FROM   "filings"
	WHERE  "cikNumber" = (SELECT "cikNumber" FROM "tickers" WHERE "symbol" = "CCL")
)
```

Get all the quarterly ratios (annualized most recent quarter):

```sql
SELECT * FROM "ratios"
WHERE "kind" = "mrq"
AND   "accessionNumber" IN (
	SELECT "accessionNumber"
	FROM   "filings"
	WHERE  "cikNumber" = (SELECT "cikNumber" FROM "tickers" WHERE "symbol" = "CCL")
)
```

Get all the annual ratios (please note that for annual reports mrq and ttm doesn’t really make sense. I still generate those rows in order to simplify the SQL query for the quarterly views):

```sql
SELECT * FROM "ratios"
WHERE "kind" = "mrq"
AND   "accessionNumber" IN (
	SELECT "accessionNumber"
	FROM   "filings"
	WHERE  "cikNumber" = (SELECT "cikNumber" FROM "tickers" WHERE "symbol" = "CCL")
	AND    "formType" = "10-K"
)
```

Ratios
------

The following formulas where used to calculate the ratios in the `ratios` table:

### Liquidity

Working Capital                = Current Assets - Current Liabilities  
Current Ratio                  = Current Assets / Current Liabilities  
Quick Ratio                    = (Cash&Equivalents + Short-term Investments + Accounts Receivable) / Current Liabilities  
Cash Ratio                     = (Cash&Equivalents + Invested Funds) / Current Liabilities  

### Profitability
Gross Profit Margin            = Gross Profit / Revenues  
Operating Profit Margin        = Operating Income / Revenues  
Pretax Profit Margin           = Pretax Income / Revenues  
Net Income Margin              = Net Income / Revenues  
Effective Tax Rate             = Income Tax Expense / Pretax Income  

### Returns
Return on Sales                = Net Income / Revenues  
Return on Assets               = Net Income / Avg. Total Assets  
Return on Equity               = Net Income / Avg. Shareholders' Equity  
Return on Capital Employed     = EBIT / (Avg. Debt Liabilities + Avg. Shareholders' Equity)  

### Debt
Debt Ratio                     = Total Liabilities / Total Assets  
Debt-Equity Ratio              = Total Liabilities / Total Shareholders' Equity  
Capitalization Ratio           = Total Debt / (Total Debt + Shareholders' Equity)  
Cash Flow-Debt Ratio           = Operating Cash Flow / Total Debt  
Interest Coverage              = EBIT / Interest Expense  

### Operating Performance
Asset Turnover                 = Revenue / Avg. Total Assets  
Fixed Asset Turnover           = Revenue / Avg. Property&Plant&Equipment  
Receivables Turnover           = Revenue / Avg. Receivables  
Inventory Turnover             = Cost of Goods Sold / Avg. Inventory  

### Cash Flow
OCF/Sales                      = Operating Cash Flow / Revenues  
Free Cash Flow/OCF             = (Operating Cash Flow - Capital Expenditure) / Operating Cash Flow  
Short-term Debt Coverage       = Operating Cash Flow / Short-term Debt  
Capital Expenditure Coverage   = Operating Cash Flow / Capital Expenditure  
Dividend Coverage              = Operating Cash Flow / Dividend  
Free Cash Flow/OCF             = (Operating Cash Flow - Capital Expenditure) / Operating Cash Flow  
Short-term Debt Coverage       = Operating Cash Flow / Short-term Debt  
Capital Expenditure Coverage   = Operating Cash Flow / Capital Expenditure  
Dividend Coverage              = Operating Cash Flow / Dividend  
